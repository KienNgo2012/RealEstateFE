<div class="chat-system" style="margin-top:5%">
    <div class="container-fluid ">
        <div class="row justify-content-center ">
            <div class="col-md-4 col-xl-3 chat">
                <div class="card mb-sm-3 mb-md-0 contacts_card">
                    <div class="card-header">
                        <div class="input-group" style="margin-bottom:20px; margin-left: 40%;">
                            <div>
                                <a [routerLink]="['/home']"> <span class="x1n2onr6">
                                        <!--$--><svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"
                                            class="x19dipnz x1lliihq x1k90msu x2h7rmj x1qfuztq"
                                            style="--color: var(--secondary-icon);">
                                            <path
                                                d="M8.99 23H7.93c-1.354 0-2.471 0-3.355-.119-.928-.125-1.747-.396-2.403-1.053-.656-.656-.928-1.475-1.053-2.403C1 18.541 1 17.425 1 16.07v-4.3c0-1.738-.002-2.947.528-4.006.53-1.06 1.497-1.784 2.888-2.826L6.65 3.263c1.114-.835 2.02-1.515 2.815-1.977C10.294.803 11.092.5 12 .5c.908 0 1.707.303 2.537.786.795.462 1.7 1.142 2.815 1.977l2.232 1.675c1.391 1.042 2.359 1.766 2.888 2.826.53 1.059.53 2.268.528 4.006v4.3c0 1.355 0 2.471-.119 3.355-.124.928-.396 1.747-1.052 2.403-.657.657-1.476.928-2.404 1.053-.884.119-2 .119-3.354.119H8.99zM7.8 4.9l-2 1.5C4.15 7.638 3.61 8.074 3.317 8.658 3.025 9.242 3 9.937 3 12v4c0 1.442.002 2.424.101 3.159.095.706.262 1.033.485 1.255.223.223.55.39 1.256.485.734.099 1.716.1 3.158.1V14.5a2.5 2.5 0 0 1 2.5-2.5h3a2.5 2.5 0 0 1 2.5 2.5V21c1.443 0 2.424-.002 3.159-.101.706-.095 1.033-.262 1.255-.485.223-.222.39-.55.485-1.256.099-.734.101-1.716.101-3.158v-4c0-2.063-.025-2.758-.317-3.342-.291-.584-.832-1.02-2.483-2.258l-2-1.5c-1.174-.881-1.987-1.489-2.67-1.886C12.87 2.63 12.425 2.5 12 2.5c-.425 0-.87.13-1.53.514-.682.397-1.495 1.005-2.67 1.886zM14 21v-6.5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5V21h4z">
                                            </path>
                                        </svg><span class="x10l6tqk x11f4b5y x1v4kod4"></span>
                                        <!--/$-->
                                    </span>
                                </a>
                            </div>
                            <div style="margin-left:10px;">
                                <a [routerLink]="['/properties-listing']"> <span class="x1n2onr6"><svg viewBox="0 0 24 24" width="24"
                                            height="24" fill="currentColor"
                                            class="x19dipnz x1lliihq x1k90msu x2h7rmj x1qfuztq"
                                            style="--color:var(--secondary-icon)">
                                            <path
                                                d="M1.588 3.227A3.125 3.125 0 0 1 4.58 1h14.84c1.38 0 2.597.905 2.993 2.227l.816 2.719a6.47 6.47 0 0 1 .272 1.854A5.183 5.183 0 0 1 22 11.455v4.615c0 1.355 0 2.471-.119 3.355-.125.928-.396 1.747-1.053 2.403-.656.657-1.475.928-2.403 1.053-.884.12-2 .119-3.354.119H8.929c-1.354 0-2.47 0-3.354-.119-.928-.125-1.747-.396-2.403-1.053-.657-.656-.929-1.475-1.053-2.403-.12-.884-.119-2-.119-3.354V11.5l.001-.045A5.184 5.184 0 0 1 .5 7.8c0-.628.092-1.252.272-1.854l.816-2.719zM10 21h4v-3.5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5V21zm6-.002c.918-.005 1.608-.025 2.159-.099.706-.095 1.033-.262 1.255-.485.223-.222.39-.55.485-1.255.099-.735.101-1.716.101-3.159v-3.284a5.195 5.195 0 0 1-1.7.284 5.18 5.18 0 0 1-3.15-1.062A5.18 5.18 0 0 1 12 13a5.18 5.18 0 0 1-3.15-1.062A5.18 5.18 0 0 1 5.7 13a5.2 5.2 0 0 1-1.7-.284V16c0 1.442.002 2.424.1 3.159.096.706.263 1.033.486 1.255.222.223.55.39 1.255.485.551.074 1.24.094 2.159.1V17.5a2.5 2.5 0 0 1 2.5-2.5h3a2.5 2.5 0 0 1 2.5 2.5v3.498zM4.581 3c-.497 0-.935.326-1.078.802l-.815 2.72A4.45 4.45 0 0 0 2.5 7.8a3.2 3.2 0 0 0 5.6 2.117 1 1 0 0 1 1.5 0A3.19 3.19 0 0 0 12 11a3.19 3.19 0 0 0 2.4-1.083 1 1 0 0 1 1.5 0A3.2 3.2 0 0 0 21.5 7.8c0-.434-.063-.865-.188-1.28l-.816-2.72A1.125 1.125 0 0 0 19.42 3H4.58z">
                                            </path>
                                        </svg>
                                      <span class="x10l6tqk x11f4b5y x1v4kod4"></span>
                                    </span>
                                </a>
                            </div>
                        </div>

                        <div class="input-group">
                            <input type="text"  (input)="searchUser($event)" placeholder="Enter username" name="search-user" class="form-control search-user">
                            <ng-container *ngIf="ListSearchUser.length > 0">
                                <ul class="contacts search-username"  >
                                  <li class="user-info search-username" *ngFor="let user of ListSearchUser"  (click)="onUserClick(user.id,user.username, user.fullName, user.roleCode,user.avatar)">
                                    <img src={{user.avatar}}
                                    class="rounded-circle user_img" style="width:40px;height:40px;"> 
                                    {{user.fullName}} [{{user.username}}]
                                  </li>
                                </ul>
                              </ng-container>
                        </div>
                    </div>
                    <div class="card-body contacts_body" style="height:465px;">
                        <ul class="contacts" *ngFor="let user of ListChatUser">
                            <li class="user-info" [ngClass]="{'active': user.username===reciverUsername}"
                                (click)="onUserClick(user.id,user.username, user.fullName, user.roleCode,user.avatar)">
                                <!-- <li class="active"> -->
                                <div class="d-flex bd-highlight">
                                    <div class="img_cont">
                                        <img src={{user.avatar}}
                                            class="rounded-circle user_img">
                                        <!-- <span class="online_icon"></span> -->
                                    </div>
                                    <div class="user_info">
                                        <span>{{user.fullName}}</span>
                                        <!-- <p>{{user.username}} <span [ngClass]="{'agent': user.roleCode==='agent', 'admin': user.roleCode==='admin'}">{{user.roleCode}}</span></p> -->
                                        <p>{{user.username}} 
                                            <span *ngIf="user.roleCode === 'agent' || user.roleCode === 'admin'" [ngClass]="{'agent': user.roleCode==='agent', 'admin': user.roleCode==='admin'}">
                                              {{user.roleCode}}
                                            </span>
                                          </p>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-8 col-xl-6 chat">
                <div class="card">
                    <div class="card-header msg_head">
                        <div class="d-flex bd-highlight">
                            <div class="img_cont">
                                <img src= {{reciverAvatar}}
                                    class="rounded-circle user_img">
                            </div>
                            <div class="user_info">
                                <span>{{receiverName}}</span>
                                <p *ngIf="reciverUsername && receiverRole">
                                    {{reciverUsername}} 
                                    <span *ngIf="receiverRole === 'agent' || receiverRole === 'admin'" [ngClass]="{'agent': receiverRole==='agent', 'admin': receiverRole==='admin'}">
                                      {{receiverRole}}
                                    </span>
                                  </p>
                                <!-- <p>{{reciverUsername}} <span [ngClass]="{'agent': receiverRole==='agent', 'admin': receiverRole==='admin'}">{{receiverRole}}</span></p> -->
                            </div>
                            <div class="video_cam">
                                <span><i class="fas fa-video"></i></span>
                                <span><i class="fas fa-phone"></i></span>
                            </div>
                        </div>
                    </div>
                    <div class="card-body msg_card_body" #chatContainer>
                        <div *ngFor="let message of ListChatHistory">
                            <div *ngIf="message.idsender!=user" class="d-flex justify-content-start mb-4">
                                <div class="img_cont_msg">
                                    <img src={{reciverAvatar}}
                                        class="rounded-circle user_img_msg">
                                </div>
                                <div class="msg_cotainer">
                                    <div class="msg-content-detail-reciver">
                                        {{message.message}}
                                    </div>
                                    <div class="msg_time"> {{message.date}}</div>
                                </div>
                            </div>
                            <div *ngIf="message.idsender==user" class="d-flex justify-content-end mb-4">
                                <div class="msg_cotainer_send">
                                    <div class="msg-content-detail-send">
                                        {{message.message}}
                                    </div>
                                    <div class="msg_time_send">{{message.date}}</div>
                                </div>
                                <div class="img_cont_msg">
                                    <img src={{senderAvatar}}
                                        class="rounded-circle user_img_msg">
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="card-footer">
                        <form (ngSubmit)="sendMessage()">
                            <div class="input-group">
                                <input type="text" [(ngModel)]="message" name="message" class="form-control message"
                                    placeholder="Message">
                                <div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
